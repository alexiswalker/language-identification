   PROCEDURE sp_TCX017(
    pi_fechaDesde IN date,
    pi_fechaHasta IN date,
    pi_usuario IN varchar2,
    PI_ESVALIDO IN INTEGER DEFAULT 1,
    po_cursor OUT ref_cursor) IS
    
     V_QUERYSELECT       VARCHAR2(10000);         
    V_FIRST             NUMBER;
    
    BEGIN
     V_FIRST := 1; 
     V_QUERYSELECT :='SELECT DISTINCT(t.NOMBREPREDETERMINADO),
                  NVL((SELECT CODIGOREASBSINPUT FROM REASEGURADOR, THIRDPARTYROLE WHERE IDDCOROLE = PK AND THIRDPARTYID = T.IDTERCERO),'' '') AS "Codigos SBS Reasegurador",
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%T001644%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "T001644",
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%1098472%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "1098472",  
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%1025453%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "1025453",     
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%T007836%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "T007836",
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%T001646%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "T001646",
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%T007831%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "T007831",
                  NVL((SELECT LISTAGG(REPLACE(REPLACE(REPLACE(TYPE,''QuotaShareReinsuranceContract'',''Cuota Parte''),''ExcedentReinsuranceContract'',''Excedente''),''Retention'',''Retencion''), ''/'') WITHIN GROUP (ORDER BY TYPE) FROM (SELECT DISTINCT RICO1.TYPE, THIRDPARTYID FROM RI_REINSURANCECONTRACT RIRE1 LEFT JOIN RI_CONTRACTCOMPONENT RICO1 ON RICO1.MAINID = RIRE1.RCID LEFT JOIN RI_CCPARTICIPATION RICCPAR1 ON RICCPAR1.CCID = RICO1.CCID LEFT JOIN RI_PARTICIPATION RIPAR1 ON RIPAR1.PARTICIPATIONID = RICCPAR1.PARTICIPATIONID WHERE RIRE1.DESCRIPTION LIKE ''%T007829%'') WHERE THIRDPARTYID = T.IDTERCERO),'' '') AS "T007829"   
                   FROM RI_REINSURANCECONTRACT RIRE
                   INNER JOIN RI_CONTRACTCOMPONENT RICO ON RICO.MAINID = RIRE.RCID
                   INNER JOIN RI_CCPARTICIPATION RICCPAR ON RICCPAR.CCID = RICO.CCID
                   INNER JOIN RI_PARTICIPATION RIPAR ON RIPAR.PARTICIPATIONID = RICCPAR.PARTICIPATIONID
                   INNER JOIN TERCERO T ON T.IDTERCERO = RIPAR.THIRDPARTYID
            WHERE';

            IF PI_FECHADESDE IS NOT NULL THEN
                  ADDSQLINSTRUCIONINQUERY(V_first, V_QUERYSELECT, ' RIRE.ENDDATE >= '||
                  GET_APPENDABLE_DATE(GET_DATE_STARTDAY(PI_FECHADESDE)) ||' ');
            END IF;
         
            IF PI_FECHAHASTA IS NOT NULL THEN
                  ADDSQLINSTRUCIONINQUERY(V_first, V_QUERYSELECT, ' RIRE.ENDDATE <=   '||
                  GET_APPENDABLE_DATE(GET_DATE_ENDDAY(PI_FECHAHASTA))||' ');
            END IF;
    
            IF PI_ESVALIDO <> 1 THEN
                ADDSQLINSTRUCIONINQUERY(V_first, V_QUERYSELECT, ' 1 = 0 ');
            END IF;
            
            V_QUERYSELECT := V_QUERYSELECT || ' ORDER BY T.NOMBREPREDETERMINADO';   

        --Registrando pista de auditoria del reporte
        REGISTRAR_AUDITORIA_REP('TCX017',pi_usuario, SYSDATE);        
        --OPEN po_cursor FOR
        OPEN po_cursor FOR V_QUERYSELECT;

    END;